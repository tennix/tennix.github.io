<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZN1HT5CXL9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZN1HT5CXL9');
    </script>

    
    <title>Î» => å‡½èˆç©ºé—´ / ARM Linux ä¸Šæ„å»º x86-64 Docker é•œåƒ</title>

    
    
        <link rel="icon" type="image/png" href=&#x2F;favicon.ico />
    
    
        <link rel=icon href='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg" viewBox="0 0 105 55"><text y=".7em" font-size="90">ğŸ¦€</text></svg>'>
    

    
    <link rel="alternate" type="application/atom+xml" title="Î» =&gt; å‡½èˆç©ºé—´" href="https://blog.funcer.xyz/atom.xml">

    
    
    
        <link rel="stylesheet" href=https://blog.funcer.xyz/custom_subset.css>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://blog.funcer.xyz/main.css />

    

    <meta name="description" content="">
    
        <meta name="robots" content="index, nofollow">
    

    <meta property="og:title" content="Î» =&gt; å‡½èˆç©ºé—´">
    <meta property="og:type" content="article" />

    

    
    <meta property="og:url" content="https:&#x2F;&#x2F;blog.funcer.xyz&#x2F;blog&#x2F;build-x86-64-docker-on-arm&#x2F;">

    <meta property="og:description" content="">
    <meta property="og:site_name" content="Î» =&gt; å‡½èˆç©ºé—´">

    <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';font-src &#x27;self&#x27; data:;img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;script-src &#x27;self&#x27; utteranc.es https:&#x2F;&#x2F;www.googletagmanager.com https:&#x2F;&#x2F;www.google-analytics.com;connect-src &#x27;self&#x27; https:&#x2F;&#x2F;www.google-analytics.com;style-src &#x27;self&#x27;;frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com utteranc.es"><script type="text/javascript" src="https://blog.funcer.xyz/js/initialize_theme_min.js"></script>
        <script defer src="https://blog.funcer.xyz/js/main_min.js"/></script></head>


<body>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href=https://blog.funcer.xyz>Î» =&gt; å‡½èˆç©ºé—´</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href=https:&#x2F;&#x2F;blog.funcer.xyz/>Home</a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href=https:&#x2F;&#x2F;blog.funcer.xyz&#x2F;archive/>Archive</a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href=https:&#x2F;&#x2F;blog.funcer.xyz&#x2F;tags/>Tags</a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href=https:&#x2F;&#x2F;blog.funcer.xyz&#x2F;about/>About</a>
                            </li>
                        
                    

                    <li class="theme-switcher-wrapper">
                            <div class="theme-switcher"></div>
                        </li></ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        

    



<main>
    <article>
        <div class="article-title">
            ARM Linux ä¸Šæ„å»º x86-64 Docker é•œåƒ
        </div>

        <ul class="meta">
            

            
                <li>


    



    

    
        
    

    
    11th 
    
        Jun 2023
    


 &#x2F;</li>
            

            <li title="333 words ">&nbsp;2 min read </li>

            
                <li>&nbsp;&#x2F;&nbsp;Tags:&nbsp;</li>
                
                    <li><a href=https://blog.funcer.xyz/tags/docker/>docker</a>,&nbsp;</li>
                
                    <li><a href=https://blog.funcer.xyz/tags/nixos/>nixos</a></li>
                
            

            
        </ul>

        

        
        

        <section class="body">
            <p>è¿‘æœŸç”³è¯·äº†ä¸€å° Mack Book Pro M1 å·¥ä½œæœºï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åæ¢æœºå™¨é…ç½®ç¯å¢ƒçš„éº»çƒ¦ï¼Œè£…äº†ä¸ª <a rel="noopener" target="_blank" href="https://nixos.org/">nixo</a> è™šæ‹Ÿæœºã€‚æœŸé—´é‡åˆ°ä¸€äº›å°é—®é¢˜ï¼Œä½†æ•´ä½“è¿˜æ˜¯å¾ˆæ»¡æ„çš„ã€‚å†™ä¸ªæ–‡æ¡£è®°å½•ä¸€ä¸‹å¦‚ä½•åœ¨ arm64 nixos ä¸Šæ„å»º x86-64 çš„ Docker é•œåƒã€‚</p>
<span id="continue-reading"></span><h2 id="TL;DR">TL;DR<a class="zola-anchor" href="#TL;DR" aria-label="Anchor link for: TL;DR">ğŸ”—</a></h2>
<ol>
<li>åœ¨ /etc/nixos/configuration.nix é…ç½®é‡Œé¢åŠ ä¸Šä¸‹é¢çš„é…ç½®</li>
</ol>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">boot</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">binfmt</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">emulatedSystems</span> <span class="z-invalid z-illegal">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-linux<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-invalid z-illegal">;</span>

<span class="z-variable z-parameter z-name z-nix">environment</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">SystemPackages</span> <span class="z-invalid z-illegal">=</span> <span class="z-invalid z-illegal z-reserved z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-invalid z-illegal">;</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">docker</span> <span class="z-variable z-parameter z-name z-nix">docker-buildx</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-invalid z-illegal">;</span>

<span class="z-variable z-parameter z-name z-nix">virtualisation</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">docker</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">enable</span> <span class="z-invalid z-illegal">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-invalid z-illegal">;</span>
</span></code></pre>
<ol start="2">
<li>åˆ›å»º amd64 builder</li>
</ol>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> buildx create<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>platform</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>amd64<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> my-amd64-builder<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>bootstrap</span></span>
</span></code></pre>
<ol start="3">
<li>æ„å»º x86-64 é•œåƒ</li>
</ol>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> buildx build<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>platform</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>linux/amd64<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>builder</span> my-amd64-builder<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>push</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> my-image .</span>
</span></code></pre>
<h2 id="Detailed">Detailed<a class="zola-anchor" href="#Detailed" aria-label="Anchor link for: Detailed">ğŸ”—</a></h2>
<p>Docker çš„è·¨å¹³å°æ„å»ºæ˜¯é€šè¿‡ BuildKit æ‰©å±•å®ç°çš„ï¼Œè€Œè·¨å¹³å°åˆ™ä¾èµ– QEMU æ¨¡æ‹Ÿå™¨ã€‚nixos é‡Œé¢å¯ç”¨ QEMU æ¨¡æ‹Ÿï¼Œåªéœ€è¦åœ¨ /etc/nixos/configuration.nix é‡Œé¢åŠ ä¸Š <code>boot.binfmt.emulatedSystems = [ &quot;x86_64-linux&quot; ];</code>ã€‚docker-buildx æ˜¯ BuildKit çš„è·¨å¹³å°æ‰©å±•ï¼Œnixos ä¸‹é¢å£°æ˜å¼å®‰è£… docker-buildxï¼š<code>environment.SystemPackages = with pkgs; [ docker docker-buildx ];</code>ã€‚å¦‚æœä¹‹å‰æ²¡å®‰è£…é…ç½®è¿‡ Dockerï¼Œåˆ™è¿˜éœ€è¦å¯ç”¨ docker æœåŠ¡ï¼š<code>virtualisation.docker.enable = true;</code>ï¼Œé…ç½®å®Œ /etc/nixos/configuration.nix åï¼Œè¿è¡Œ <code>sudo nixos-rebuild switch</code> å°±å®‰è£…å¹¶å¯ç”¨äº† docker æœåŠ¡ã€‚</p>
<p>docker buildx é»˜è®¤æœ‰ä¸€ä¸ªå½“å‰æ¶æ„çš„ builderï¼Œå¯ä»¥é€šè¿‡ <code>docker buildx ls</code> åˆ—å‡ºæ‰€æœ‰ builderã€‚<code>docker buildx create --platform=amd64 --name my-amd64-builder --bootstrap</code> ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ builderï¼Œä¸å†ä½¿ç”¨çš„ builder å¯ä»¥é€šè¿‡ <code>docker buildx rm my-amd64-builder</code> æ–¹å¼åˆ æ‰ã€‚</p>

        </section>

    </article>
</main>


    <!-- Utterances uses GitHub issue for comment -->
    <div class="comments">
      <script async src="https://utteranc.es/client.js"
              repo="tennix/tennix.github.io"
              issue-term="pathname"
              label="comment"
              theme="preferred-color-scheme"
              crossorigin="anonymous">
      </script>
    </div>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
                <ul>
                        <li>
                            <a rel="noopener noreferrer" target="_blank" class="nav-links no-hover-padding social" href=https:&#x2F;&#x2F;github.com&#x2F;tennix>
                                <img alt=GitHub title=GitHub src="https:&#x2F;&#x2F;blog.funcer.xyz/social_icons/github.svg">
                            </a>
                        </li>
                    
                        <li>
                            <a rel="noopener noreferrer" target="_blank" class="nav-links no-hover-padding social" href=https:&#x2F;&#x2F;twitter.com&#x2F;ztennix>
                                <img alt=Twitter title=Twitter src="https:&#x2F;&#x2F;blog.funcer.xyz/social_icons/twitter.svg">
                            </a>
                        </li>
                    
                        <li>
                            <a rel="noopener noreferrer" target="_blank" class="nav-links no-hover-padding social" href=https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;shuan-deng-6b5a6698&#x2F;>
                                <img alt=LinkedIn title=LinkedIn src="https:&#x2F;&#x2F;blog.funcer.xyz/social_icons/linkedin.svg">
                            </a>
                        </li>
                    
                </ul>
            
        </nav>
        <div class="credits">
            <small> Powered by  <a href="https://www.getzola.org" target="_blank">Zola</a> &  <a href="https://github.com/welpo/tabi" target="_blank">tabi</a></small>
        </div>
    </section>
</footer>


    
</body>

</html>
